<!-- load the CSS files in the right order -->
<link href="node_modules/bootstrap-fileinput/css/fileinput.min.css" rel="stylesheet" type="text/css">
<link href="node_modules/bootstrap-fileinput/themes/explorer-fas/theme.min.css" rel="stylesheet" type="text/css">

<!-- load the JS files in the right order -->
<script type='text/javascript' src='node_modules/bootstrap-fileinput/js/fileinput.min.js'></script>
<script type='text/javascript' src='node_modules/bootstrap-fileinput/themes/explorer-fas/theme.min.js'></script>

<form id ="form_expediente" >
    <input type=hidden name='que' id='que' value=0>
    <input type=hidden name='id_expediente' id='id_expediente' value={{ id_expediente }} >
    <input type=hidden name='ponente' id='ponente' value={{ id_ponente }} >
    
<div class="clearfix">
	<div class="d-inline-flex float-left">
        <div class="p-2 bg-warning text-dark font-weight-bold" >
        {{ ponente_txt }}
        </div>
        <div class="p-2 bg-info" >
        {{ tramite_txt }}
        </div>
        <div class="p-2 bg-warning" >
        {{ estado_txt }}
        </div>
        <!--  --------------- OFICINAS --------------- -->
        <div class="p-2 bg-white" >
          {{ "Oficinas"|trans }}: {{ oArrayDesplFirmas.Lista|raw }}
        </div>
  
    </div>
	<div class="d-inline-flex float-right">
        <div class="p-2 bg-warning" >
    	{{ prioridad_txt }}
    	</div>
    </div>
</div>
<!-- Fechas -->
<div class="clearfix">
	<div class="d-inline-flex float-left">
        <div class="p-2" >
            {{ "Inicio"|trans }}: {{ f_ini_circulacion }}
        </div>
        <div class="p-2" >
            {{ "reunión"|trans }}: {{ f_reunion }}
        </div>
        <div class="p-2" >
            {{ "aprobación"|trans }}: {{ f_aprobacion }}
        </div>
    </div>
	<div class="d-inline-flex float-right">
        <div class="p-2 bg-warning" >
        	{{ "contestar"|trans }}: {{ f_contestar }}
    	</div>
    </div>
</div>

<!--  --------------- ASUNTO --------------- -->
<div class="row">
	<div class="col-1">
  	{{ "Asunto"|trans }}:
  	</div>
    <div class="col-11 alert alert-primary">
      {{ asunto }}
    </div>
</div>

<div class="row" >
<!--  Col Izda -->
<div class="col-8" >
  <!--  --------------- ENTRADILLA --------------- -->
  <div class="alert alert-primary">
    {{ entradilla }}
  </div>
  <!--  --------------- COMENTARIOS --------------- -->
  <div class="alert bg-light">
    {{ comentarios|raw }}
  </div>
  
<!--  --------------- ACCIONES --------------- -->
{{ oEscritoLista.mostrarTabla()|raw }}
</div>
<!-- Fin Col Izda -->
<!--  Col Dcha -->
<div class="col-4" >
<!--  --------------------  ANTECEDENTES  --------------------------  -->
{# lista de antecedentes #}
<div class="form-group col-md-12">
  <label>{{ "Antecedentes"|trans }}:</label>
</div>
<hr>
<div id="lista_antecedentes">
{{ lista_antecedentes|raw }}
</div>

<!--  --------------------  RECORRIDO  --------------------------  -->
<div class="form-group col-md-12">
<label>{{ "Recorrido"|trans }}:</label>
<ol id="lst_recorrido" class="list-group">
  {% for row in a_recorrido %}
	<li class="list-group-item {{ row.class }}">{{ row.valor }}</li>
  {% endfor %}
</ol>
</div>


<!-- Fin Col Dcha -->
</div>
<!-- Fin row -->

  <!--  --------------------  BOTONES --------------------------  -->
  <button id='btn_volver' tabindex='91' class="btn btn-secondary" onClick="fnjs_cancelar(event);" >
    {{ "Volver"|trans }}
  </button>
   <button tabindex='90' class="btn btn-success" onClick="fnjs_distribuir(event);" >
    {{ "Distribuir"|trans }}
  </button>
</form>

{{ include ('_antecedentes_js.html.twig') }}
<script type="text/javascript">
fnjs_recorrido=function() {
		var id_expediente=$('#id_expediente').val();
		var url_ajax = 'apps/tramites/controller/firma_ajax.php';
		var param_json = { que: 'recorrido', id_expediente: id_expediente };
	    request=$.ajax({
	        data: param_json,
	        url: url_ajax,
	        type: 'post'
	    });
	    request.done( function (json) {
            if (json.success != true) {
                alert (json.mensaje);
            } else {
	            var a_recorrido = JSON.parse(json.recorrido);
	            html='';
                for (row of a_recorrido) {
                	html+='<li class="list-group-item '+row.class+' }}">'+row.valor+'</li>';
	    		}
                $("#lst_recorrido").html(html);
            }
	    });
}
  
	
fnjs_cancelar=function(event) {
	// Asegurarme que es por click y no por return (posicion: 0,0)
	var x = event.x || event.clientX;
    var y = event.y || event.clientY;
    if (!x && !y) {
        event.preventDefault();
        event.stopPropagation();
        event.stopImmediatePropagation();
    	return false;
    }
    event.preventDefault(); //prevent default action 	
	fnjs_update_div('#main','{{ pagina_cancel|raw }}');
}

fnjs_distribuir_escrito=function(id_escrito) {
    var ssfsv = 'sv';
    var winPrefs="dependent=yes,width=950,height=700,screenX=200,screenY=200,titlebar=yes,scrollbars=yes";
    var server = '{{ server }}'
    var url = server+'/apps/expedientes/controller/escrito_distribuir.php?id_escrito='+id_escrito;
    w=window.open(url, "sele", winPrefs);
    w.focus();
}

fnjs_revisar_escrito=function(event,id_escrito) {
    var winPrefs="dependent=yes,width=1400,height=800,screenX=200,screenY=200,titlebar=yes,scrollbars=yes";
    var url_ajax = 'apps/etherpad/controller/getUrlEscrito.php';
    var param_json = { tipo_id: 'escrito', id: id_escrito };
    
    request=$.ajax({
        data: param_json,
        url: url_ajax,
        type: 'post'
    });

    request.done( function (rta) {
        // antes, dentro del ajax, hacia falta el responseText
        //url=rta.responseText;
        url=rta;
        w=window.open(url, "sele", winPrefs);
        w.focus();
    });
	request.fail(function(JqXHR, textStatus, errorThrown){
		alert('An error occurred... Look at the console (F12 or Ctrl+Shift+I, Console tab) for more information!');
        console.error("Hi ha un error: "+ textStatus, errorThrown);
    });
    
    /*
    request.always(function(){
        alert("JEJE");
        debugger;
    });
    */

    event.preventDefault();
	event.stopPropagation();
	event.stopImmediatePropagation();
	return false;
}

$(document).ready(function() {
	tabs_hide();
});
