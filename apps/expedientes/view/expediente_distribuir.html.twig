<!-- load the CSS files in the right order -->
<link href="node_modules/bootstrap-fileinput/css/fileinput.min.css" rel="stylesheet" type="text/css">
<link href="node_modules/bootstrap-fileinput/themes/explorer-fas/theme.min.css" rel="stylesheet" type="text/css">

<!-- load the JS files in the right order -->
<script type='text/javascript' src='node_modules/bootstrap-fileinput/js/fileinput.min.js'></script>
<script type='text/javascript' src='node_modules/bootstrap-fileinput/themes/explorer-fas/theme.min.js'></script>

<form id ="form_expediente" >
    <input type=hidden name='que' id='que' value=0>
    <input type=hidden name='id_expediente' id='id_expediente' value={{ id_expediente }} >
    <input type=hidden name='ponente' id='ponente' value={{ id_ponente }} >

<!-- oficina... linea1 -->
<div class="clearfix">
	<div class="d-inline-flex float-left">
        <div class="p-2 bg-warning text-dark font-weight-bold" >
        {{ ponente_txt }}
        </div>
        <div class="p-2 bg-info" >
        {{ tramite_txt }}
        </div>
        <div class="p-2 bg-warning" >
        {{ estado_txt }}
        </div>
    </div>
	<div class="d-inline-flex float-right">
        <div class="p-2 bg-warning" >
    	{{ prioridad_txt }}
    	</div>
    </div>
</div>
<!-- Fechas linea2 -->
<div class="clearfix">
	<div class="d-inline-flex float-left">
        <div class="p-2" >
            {{ "Inicio"|trans }}: {{ f_ini_circulacion }}
        </div>
        <div class="p-2" >
            {{ "reunión"|trans }}: {{ f_reunion }}
        </div>
        <div class="p-2" >
            {{ "aprobación"|trans }}: {{ f_aprobacion }}
        </div>
    </div>
	<div class="d-inline-flex float-right">
        <div class="p-2 bg-warning" >
        	{{ "contestar"|trans }}: {{ f_contestar }}
    	</div>
    </div>
</div>

<!--  Expediente -->
<div class="">
  <!--  --------------- ASUNTO --------------- -->
  <div class="row">
	<div class="col-1">
  	{{ "Asunto"|trans }}:
  	</div>
    <div class="col-11 alert alert-primary">
      {{ asunto }}
    </div>
  </div>
  <div class="row" >
    <!--  Col Izda -->
    <div class="col-9" >
      <!--  --------------- ENTRADILLA --------------- -->
      <div class="alert alert-primary">
        {{ entradilla }}
      </div>
      <!--  --------------- COMENTARIOS --------------- -->
      <div class="alert bg-light">
        {{ comentarios|raw }}
      </div>
      
    <!--  --------------- ACCIONES --------------- -->
    {{ oEscritoLista.mostrarTabla()|raw }}
    </div>
    <!-- Fin Col Izda -->
    <!--  Col Dcha -->
    <div class="col-3" >
      <!--  --------------------  ANTECEDENTES  --------------------------  -->
      <div class="form-group col-md-12">
        <label>{{ "Antecedentes"|trans }}:</label>
        <div id="lista_antecedentes">
          {{ lista_antecedentes|raw }}
        </div>
      </div>
      <hr>
      <!--  --------------------  RECORRIDO  --------------------------  -->
      <div class="form-group col-md-12">
      <label>{{ "Recorrido"|trans }}:</label>
        <ol id="lst_recorrido" class="list-group">
        {% for row in a_recorrido %}
          <li class="list-group-item {{ row.class }}">{{ row.valor }}</li>
        {% endfor %}
        </ol>
      </div>
    </div>
    <!-- Fin Col Dcha -->
  </div> 
  
<!--  --------------- Etiquetas --------------- -->
{% if ver_etiquetas %}
  <div id="div_etiquetas" class="form-group row">
    <label for="etiquetas" class="col-sd-2">{{ "Etiquetas"|trans }}:</label>
    <div class="col-6">
      <span id="span_etiquetas">
      	{{ oArrayDesplEtiquetas.ListaSelects|raw }}
      </span>
    </div>
  </div>
 {% endif %}
  
  <!--  --------------------  BOTONES --------------------------  -->
  <button tabindex='91' class="btn btn-secondary" onClick="fnjs_cancelar(event);" >
    {{ "Volver"|trans }}
  </button>
  <button tabindex='90' class="btn btn-success" onClick="fnjs_distribuir(event,'{{ btn_action }}');" >
    {{ txt_btn_success }}
  </button> 
</div> 
</form>

{{ include ('_antecedentes_js.html.twig') }}
<script type="text/javascript">
fnjs_recorrido=function() {
		var id_expediente=$('#id_expediente').val();
		var url_ajax = 'apps/tramites/controller/firma_ajax.php';
		var param_json = { que: 'recorrido', id_expediente: id_expediente };
	    request=$.ajax({
	        data: param_json,
	        url: url_ajax,
	        type: 'post'
	    });
	    request.done( function (json) {
            if (json.success != true) {
                alert (json.mensaje);
            } else {
	            var a_recorrido = JSON.parse(json.recorrido);
	            html='';
                for (row of a_recorrido) {
                	html+='<li class="list-group-item '+row.class+' }}">'+row.valor+'</li>';
	    		}
                $("#lst_recorrido").html(html);
            }
	    });
}
  
	
fnjs_cancelar=function(event) {
	// Asegurarme que es por click y no por return (posicion: 0,0)
	var x = event.x || event.clientX;
    var y = event.y || event.clientY;
    if (!x && !y) {
        event.preventDefault();
        event.stopPropagation();
        event.stopImmediatePropagation();
    	return false;
    }
    event.preventDefault(); //prevent default action 	
	fnjs_update_div('#main','{{ pagina_cancel|raw }}');
}

fnjs_distribuir=function(event,que){
	// Asegurarme que es por click y no por return (posicion: 0,0)
	var x = event.x || event.clientX;
    var y = event.y || event.clientY;
    if (!x && !y) {
        event.preventDefault();
        event.stopPropagation();
        event.stopImmediatePropagation();
    	return false;
    }

    $('#form_expediente').attr('action','{{ url_update }}');
    $('#que').val(que);
    $('#form_expediente').one("submit", function(event){
        event.preventDefault(); //prevent default action 	
        request=$.ajax({
            data: $(this).serialize(),
            url: $(this).attr('action'),
            type: 'post',
            dataType: 'json'
        });
        request.done( function (json) {
            if (json.success != true) {
                alert ('error: '+json.mensaje);
            } else {
                //alert ("{{ "ok distribuir"|trans }}");
                // Volver a la lista...
                fnjs_update_div('#main','{{ pagina_cancel|raw }}');
            }
        });
    });
}

{{ oArrayDesplEtiquetas.ComprobarSelectJs|raw }}
fnjs_mas_etiquetas=function(e){
	var code = (e.keyCode ? e.keyCode : e.which);
	if(e=="x") {
		var valor=1;
	} else {
		var id_campo='#'+e.currentTarget.id;
		var valor=$(id_campo).val();
		if(code!=9) {
			e.preventDefault();
			e.stopPropagation();
		}
	}
	if ( code==9 || e.type=="change" || e=="x") {
		if (valor!=0) {
			{{ oArrayDesplEtiquetas.ListaSelectsJs|raw }}
		}
	}
}

fnjs_quitar_etiquetas=function(){
	$('#span_etiquetas').html("");
	$('#etiquetas_num').val(0);
}

$(document).ready(function() {
	tabs_hide();
});
