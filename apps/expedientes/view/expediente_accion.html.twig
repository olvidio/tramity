<!-- Modal -->
<div class="modal fade" id="ModalBuscar" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLongTitle">{{ "Buscar"|trans }}</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
      	<div id="busqueda">
          <!--  --------------- BUSQUEDAS --------------- -->
          <!--  --------------- ASUNTO --------------- -->
          <div class="form-group row">
            <label for="asunto" class="col-2 col-form-label">{{ "Asunto"|trans }}</label>
            <div class="col-8">
              <input tabindex='30' type="text" class="form-control" name="asunto" id="asunto_buscar" value="">
            </div>
              <div class="col-2">
                <button type="button" class="btn btn-primary" onClick="fnjs_buscar_expediente(event);" >{{ "Buscar"|trans }}</button>
              </div>
          </div>
        </div>
        <hr>
      	<div id="lista">
        </div>
      </div>
      <div class="modal-footer">
      </div>
    </div>
  </div>
</div>


<div class="card w-50 mx-auto ">
  <div class="card-header">
    <h5 class="card-title">{{ "Acciones para el expediente"|trans }}:</h5>
    <h5 class="card-title">{{ asunto }}</h5>
  </div>
  <div class="card-body">
<div class="row">
{% for row in a_botones %}
  <div class="col">
  	{% if row.tipo == 'modal' %}
      <button type="button" class="btn btn-info" data-toggle="modal" data-target="#ModalBuscar" onClick="fnjs_buscar_expediente(event);" >
        {{ row.txt }}
      </button>
  	{% else %}
	  <button type="button" class="btn btn-info" onclick="fnjs_accion('{{ row.accion }}')">{{ row.txt }}</button>
  	{% endif %}
  </div>
{% endfor %}
</div>
</div>
</div>

<div class="row">
<div class="col" style="margin: 1cm;"><!-- per quedar alineat del pills que tambÃ© tenen un marge de 1cm. -->
  <button type="button" class="btn btn-secondary" onClick="fnjs_cancelar(event);" >
    {{ "Cancelar"|trans }}
  </button>
</div>
</div>
    
<script>
fnjs_accion=function(accion){
	if (accion == 'exp_cp_oficina') {
		alert ('hay que poner la funcion de escoger oficina destino');
		return false;
	}
	var err=0;
    // grabar
    var url_ajax = 'apps/expedientes/controller/expediente_update.php';
	if (accion == 'en_expediente') {
	    var param_json = { que: accion, id_expediente: {{ id_expediente }}, id_entrada: {{ id_entrada }} };
	} else {
        var param_json = { que: accion, id_expediente: {{ id_expediente }} };
	}
    request=$.ajax({
        data: param_json,
        url: url_ajax,
        type: 'post'
    });
    request.done( function (json) {
        if (json.success != true) {
            rta_txt = json.mensaje;
            alert ('error: '+rta_txt);
        } else {
        	fnjs_update_div('#main','{{ pagina_cancel|raw }}');
        }
    });
}

fnjs_cancelar=function(event){
	// Asegurarme que es por click y no por return (posicion: 0,0)
	var x = event.x || event.clientX;
    var y = event.y || event.clientY;
    if (!x && !y) {
        event.preventDefault();
        event.stopPropagation();
        event.stopImmediatePropagation();
    	return false;
    }
    event.preventDefault(); //prevent default action 	
	fnjs_update_div('#main','{{ pagina_cancel|raw }}');
}

fnjs_buscar_expediente=function(event) {
	var err=0;
	var que = 'buscar_exp';
	var id_entrada={{ id_entrada }};
	var asunto_buscar=$('#asunto_buscar').val();
	
	if (err!=1) {
        var url_ajax = 'apps/expedientes/controller/antecedentes_ajax.php';
        var param_json = { que: que, id_entrada: id_entrada, asunto_buscar: asunto_buscar };
        request=$.ajax({
            data: param_json,
            url: url_ajax,
            type: 'post'
        });
        request.done( function (rta) {
            //debugger;
            //rta_txt=rta.responseText;
            rta_txt=rta;
            if (rta_txt==undefined) {
                rta_txt='';
            }
            if (rta_txt != '' && rta_txt != '\n') {
                $('#lista').html(rta);
            }
        });
	}
}

fnjs_adjuntar_antecedente=function(tipo,id_escrito,id_expediente) {
	var que='adjuntar';
	
	//alert("entrada: "+id_entrada+"; exp.: "+id_expediente);
    var url_ajax = 'apps/expedientes/controller/antecedentes_ajax.php';
    
    var param_json = { que: que, tipo_doc: tipo, id_expediente: id_expediente, id_escrito: id_escrito };
    request=$.ajax({
        data: param_json,
        url: url_ajax,
        type: 'post'
    });
    request.done( function (rta) {
        rta_txt=rta;
        if (rta_txt==undefined) {
            rta_txt='';
        }
        if (rta_txt != '' && rta_txt != '\n') {
		    $('#lista_antecedentes').html(rta);
        }
    });
	
	// close div modal
    $('#ModalBuscar .close').click();
}
</script>