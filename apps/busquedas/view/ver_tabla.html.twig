<h2 class=subtitulo>{{ titulo }}</h2>
<form id='{{ key }}' name='{{ key }}' action='' method='post'>
    <input type='hidden' name='filtro' value='buscar'>
    <input type='hidden' name='condicion' value='{{ condicion|raw }}'>
    <input type='hidden' name='que' value=''>
    {{ oTabla.mostrar_tabla|raw }}
</form><br>

<script>
////////////////  Entradas /////////////////////

fnjs_modificar_det_entrada=function(formulario){
    rta=fnjs_solo_uno(formulario);
    if (rta==1) {
        fnjs_actualizar();
        //$(formulario).attr('action',"apps/entradas/controller/entrada_form.php");
        //fnjs_enviar_formulario(formulario,'#main');
    }
}
fnjs_modificar_entrada=function(formulario){
    rta=fnjs_solo_uno(formulario);
    if (rta==1) {
        $(formulario).attr('action',"apps/entradas/controller/entrada_form.php");
        fnjs_enviar_formulario(formulario,'#main');
    }
}
fnjs_borrar_entrada=function(formulario){
    rta=fnjs_solo_uno(formulario);
    var seguro;
    if (rta==1) {
        seguro=confirm("{{ "¿Está Seguro que desea borrar este registro?"|trans }}");
        if (seguro) {
            var form=$(formulario).attr('id');
            var id_reg;
            /* selecciono los elementos con class="sel" de las tablas del id=formulario */
            /* var sel=$('#'+formulario+' table .sel'); */
            $('#'+form+' input.sel').each(function(i){
                if($(this).prop('checked')== true) {
                    // como ya he comprobado que sólo está uno seleccionado, es este.
                    var array_dir=$(this).val().split('#');
                    id_reg=array_dir[0];
                }
            });

            alert("falta comprobar los pendientes");
            
            var url_doc = 'apps/entradas/controller/entrada_ajax.php';
            var param_json = { que: 'eliminar', id_entrada: id_reg };
            request=$.ajax({
                data: param_json,
                url: url_doc,
                type: 'post',
                dataType: 'json'
            });
            request.done( function (json) {
            	if (json.success != 'true') {
            		alert (json.mensaje);
                } else {
                    fnjs_actualizar();
                }
            });
        }
    }
}
////////////////  Escritos /////////////////////
fnjs_modificar_det_escrito=function(formulario){
    rta=fnjs_solo_uno(formulario);
    if (rta==1) {
        $(formulario).attr('action',"apps/expedientes/controller/escrito_form.php");
        fnjs_enviar_formulario(formulario,'#main');
    }
}
fnjs_modificar_escrito=function(formulario){
    rta=fnjs_solo_uno(formulario);
    if (rta==1) {
        $(formulario).attr('action',"apps/expedientes/controller/escrito_form.php");
        fnjs_enviar_formulario(formulario);
    }
}
fnjs_borrar_escrito=function(formulario){
    rta=fnjs_solo_uno(formulario);
    if (rta==1) {
        seguro=confirm("{{ "¿Está Seguro que desea borrar este escrito?"|trans }}");
        if (seguro) {
            var form=$(formulario).attr('id');
            var id_reg;
            /* selecciono los elementos con class="sel" de las tablas del id=formulario */
            /* var sel=$('#'+formulario+' table .sel'); */
            $('#'+form+' input.sel').each(function(i){
                if($(this).prop('checked')== true) {
                    // como ya he comprobado que sólo está uno seleccionado, es este.
                    var array_dir=$(this).val().split('#');
                    id_reg=array_dir[0];
                }
            });

            var url_doc = "apps/expedientes/controller/escrito_update.php";
            var param_json = { que: 'eliminar', id_escrito: id_reg };
            request=$.ajax({
                data: param_json,
                url: url_doc,
                type: 'post',
                dataType: 'json'
            });
            request.done( function (json) {
            	if (json.success != 'true') {
            		alert (json.mensaje);
                } else {
                    fnjs_actualizar();
                }
            });
        }
    }
}

fnjs_actualizar=function(){
    var url_doc = 'apps/busquedas/controller/ver_tabla.php';
    var param_json = '{{ condicion|raw }}';
    request=$.ajax({
        data: param_json,
        url: url_doc,
        type: 'post'
    });
	request.done( function (resposta) {
		fnjs_mostra_resposta (resposta,"#resultados");
	});
	request.fail(function(JqXHR, textStatus, errorThrown){
		alert('An error occurred... Look at the console (F12 or Ctrl+Shift+I, Console tab) for more information!');
        console.error("Hi ha un error: "+ textStatus, errorThrown);
    });

}
</script>
