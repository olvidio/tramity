<h2 class=subtitulo>{{ titulo }}</h2>
<form id='seleccionados' name='seleccionados' action='' method='post'>
	<input type="hidden" id="que" name="que" value='' />
    {{ oTabla.mostrar_tabla|raw }}
</form>
<br>

<button type="button" class="btn btn-primary btn btn-block" onclick="fnjs_update_div('#main','{{ url_nuevo }}');">
{{ "nueva plantilla"|trans}}
</button>
<script>
fnjs_datos_plantilla=function(){
	$('#seleccionados').attr('action',"{{ url_form }}");
	fnjs_enviar_formulario('#seleccionados');
}

fnjs_eliminar_plantilla=function(){
	rta=fnjs_solo_uno('#seleccionados');
	if (rta==1) {
		if (confirm("{{ "¿Está seguro que desea borrar esta plantilla?"|trans }}") ) {
            $('#que').val('eliminar');
			$('#seleccionados').attr('action',"{{ url_eliminar }}");
			$('#seleccionados').one("submit", function(event) {
				event.preventDefault();
				$.ajax({
					url: $(this).attr('action'),
					type: 'post',
					data: $(this).serialize()
				})
				.done(function (rta_txt) {
					if (rta_txt != '' && rta_txt != '\n') {
						alert ('{{ "respuesta"|trans|raw }}: '+rta_txt);
					} else {
						fnjs_actualizar();
				   	}
				});
				return false;
			});
			$('#seleccionados').trigger("submit");
			$('#seleccionados').off();
		}
	}
}
fnjs_actualizar=function(){
	var url='{{ url_actualizar }}';
	fnjs_update_div('#main',url);
}

fnjs_revisar_plantilla=function(event,id_plantilla) {
    var winPrefs="dependent=yes,width=1400,height=800,screenX=200,screenY=200,titlebar=yes,scrollbars=yes";
    var url_ajax = 'apps/etherpad/controller/getUrlEscrito.php';
    var param_json = { tipo_id: 'plantilla', id: id_plantilla };
    
    request=$.ajax({
        data: param_json,
        url: url_ajax,
        type: 'post'
    });

    request.done( function (rta) {
        // antes, dentro del ajax, hacia falta el responseText
        //url=rta.responseText;
        url=rta;
        w=window.open(url, "", winPrefs);
        w.focus();
    });
	request.fail(function(JqXHR, textStatus, errorThrown){
		alert('An error occurred... Look at the console (F12 or Ctrl+Shift+I, Console tab) for more information!');
        console.error("Hi ha un error: "+ textStatus, errorThrown);
    });

    event.preventDefault();
	event.stopPropagation();
	event.stopImmediatePropagation();
	return false;
}

</script>
