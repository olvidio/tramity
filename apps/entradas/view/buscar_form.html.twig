<h1>{{ titulo }}</h1>
<form id ="form_buscar" >
    <input type=hidden name='que' id='que' value=0>
    <input type=hidden name='id_expediente' id='id_expediente' value={{ id_expediente }} >
    
    
  <div class="form-group row">
    <label for="ponente" class="col-2 col-form-label">{{ "Oficina"|trans }}</label>
    <div class="col-1">
	  {{ oDesplOficinas.desplegable|raw }}
    </div>
  </div>
  <div class="form-group row">
    <label for="ponente" class="col-2 col-form-label">{{ "Origen"|trans }}</label>
    <div class="col-1">
	  {{ oDesplLugares.desplegable|raw }}
    </div>
  </div>
  <!--  --------------- ASUNTO --------------- -->
  <div class="form-group row">
    <label for="asunto" class="col-2 col-form-label">{{ "Asunto"|trans }}</label>
    <div class="col-8">
      <input tabindex='30' type="text" class="form-control" name="asunto" id="asunto" value="">
    </div>
  </div>
  
  <div>
    <button type="button" class="btn btn-secondary" onClick="fnjs_cancelar(event);" >
      {{ "Cancelar"|trans }}
    </button>
    <button type="button" class="btn btn-primary" onClick="fnjs_buscar(event);" >
      {{ "Buscar"|trans }}
    </button>
  </div>
</form>

<div id="resultados"></div>
<script>
fnjs_cancelar=function(event){
	// Asegurarme que es por click y no por return (posicion: 0,0)
	var x = event.x || event.clientX;
    var y = event.y || event.clientY;
    if (!x && !y) {
        event.preventDefault();
        event.stopPropagation();
        event.stopImmediatePropagation();
    	return false;
    }
    event.preventDefault(); //prevent default action 	
	fnjs_update_div('#main','{{ pagina_cancel|raw }}');
}

fnjs_buscar=function(event){
	// Asegurarme que es por click y no por return (posicion: 0,0)
	var x = event.x || event.clientX;
    var y = event.y || event.clientY;
    if (!x && !y) {
        event.preventDefault();
        event.stopPropagation();
        event.stopImmediatePropagation();
    	return false;
    }

	$('#form_buscar').attr('action','{{ pagina_buscar }}');
    $('#que').val('buscar');
    $('#form_buscar').one("submit", function(event){
        event.preventDefault(); //prevent default action 	
        request=$.ajax({
            data: $(this).serialize(),
            url: $(this).attr('action'),
            type: 'post'
            //dataType: 'json'
        });
        request.done( function (rta) {
            //debugger;
            $('#resultados').html(rta);
        });
    });
    $('#form_buscar').submit();
}

fnjs_adjuntar_entrada=function(id_entrada,id_expediente) {
	// adjuntar entrada a expediente (la funcion se carga al cargar el expediente)
	fnjs_adjuntar_antecedente('entrada',id_entrada,id_expediente);
	// ir a nuevo escrito con los valores de asunto,oficinas,  del escrito.
	// a) consultar valores:
    var param_json = { id_expediente: id_expediente, id_entrada: id_entrada };
    
	request=$.ajax({
        data: param_json,
        url: '{{ url_escrito|raw }}',
        type: 'post',
        dataType: 'html'
    });
    request.done( function (html) {
        $('#main').html(html);
    });
}
</script>